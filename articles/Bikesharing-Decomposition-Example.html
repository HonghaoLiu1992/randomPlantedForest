<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="randomPlantedForest">
<title>Bikesharing: Decomposition Example • randomPlantedForest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bikesharing: Decomposition Example">
<meta property="og:description" content="randomPlantedForest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">randomPlantedForest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Bikesharing-Decomposition-Example.html">Bikesharing: Decomposition Example</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PlantedML/randomPlantedForest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bikesharing: Decomposition Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PlantedML/randomPlantedForest/blob/HEAD/vignettes/articles/Bikesharing-Decomposition-Example.Rmd" class="external-link"><code>vignettes/articles/Bikesharing-Decomposition-Example.Rmd</code></a></small>
      <div class="d-none name"><code>Bikesharing-Decomposition-Example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PlantedML/randomPlantedForest" class="external-link">randomPlantedForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com" class="external-link">ISLR2</a></span><span class="op">)</span> <span class="co"># For Bikeshare dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># Some post-processing required!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># To arrange plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the Data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>First we load the <code>Bikeshare</code> data from the
<code>ISLR2</code> package, which provides the dataset published at the
<a href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" class="external-link">UCI
Machine Learning Repository</a>.</p>
<blockquote>
<p>This data set contains the hourly and daily count of rental bikes
between years 2011 and 2012 in Capital bikeshare system, along with
weather and seasonal information.</p>
</blockquote>
<p>The outcome is going to be <code>bikers</code>, the total number of
bikers in the system.</p>
<p>The predictors of interest in our case are going to be the
following:</p>
<ul>
<li>
<code>hr</code>: Hour of day, 0 to 23 hours.</li>
<li>
<code>temp</code>: Normalized temperature in Celsius</li>
<li>
<code>workingday</code>: Binary value indicating whether it’s a work
day (1) or not (0)</li>
</ul>
<p>We recode the <code>hr</code> column from a 24-level
<code>factor</code> to a numeric column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">hr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">workingday</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">workingday</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No Workingday"</span>, <span class="st">"Workingday"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">season</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">season</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Winter"</span>, <span class="st">"Spring"</span>, <span class="st">"Summer"</span>, <span class="st">"Fall"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Only one observation with this condition, removing it to make space.</span></span>
<span><span class="va">bike</span> <span class="op">&lt;-</span> <span class="va">bike</span><span class="op">[</span><span class="va">weathersit</span> <span class="op">!=</span> <span class="st">"heavy rain/snow"</span>, <span class="op">]</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bike</span><span class="op">)</span></span>
<span><span class="co">#&gt;    season mnth day hr holiday weekday    workingday   weathersit temp  atemp</span></span>
<span><span class="co">#&gt; 1: Winter  Jan   1  0       0       6 No Workingday        clear 0.24 0.2879</span></span>
<span><span class="co">#&gt; 2: Winter  Jan   1  1       0       6 No Workingday        clear 0.22 0.2727</span></span>
<span><span class="co">#&gt; 3: Winter  Jan   1  2       0       6 No Workingday        clear 0.22 0.2727</span></span>
<span><span class="co">#&gt; 4: Winter  Jan   1  3       0       6 No Workingday        clear 0.24 0.2879</span></span>
<span><span class="co">#&gt; 5: Winter  Jan   1  4       0       6 No Workingday        clear 0.24 0.2879</span></span>
<span><span class="co">#&gt; 6: Winter  Jan   1  5       0       6 No Workingday cloudy/misty 0.24 0.2576</span></span>
<span><span class="co">#&gt;     hum windspeed casual registered bikers</span></span>
<span><span class="co">#&gt; 1: 0.81    0.0000      3         13     16</span></span>
<span><span class="co">#&gt; 2: 0.80    0.0000      8         32     40</span></span>
<span><span class="co">#&gt; 3: 0.80    0.0000      5         27     32</span></span>
<span><span class="co">#&gt; 4: 0.75    0.0000      3         10     13</span></span>
<span><span class="co">#&gt; 5: 0.75    0.0000      0          1      1</span></span>
<span><span class="co">#&gt; 6: 0.75    0.0896      0          1      1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-purification-component-extraction">Fitting, Purification, Component Extraction<a class="anchor" aria-label="anchor" href="#fitting-purification-component-extraction"></a>
</h2>
<p>Next we can fit a Random Planted Forest on the <code>bikers</code>
variable, using a subset of the available predictors. We limit the
model’s complexity by setting <code>max_interaction = 3</code>, as we
are only going to visualize interactions up to the third degree, and
using a higher value here might only marginally improve predictive
performance at the cost of a longer runtime. For our example here, a
smaller model with merely 20 trees suffices. We also <code>purify</code>
the forest to enable the desired decomposition. This step is not
required for global predictions and may take some time, which is why it
is implemented as a separate step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpf.html">rpf</a></span><span class="op">(</span></span>
<span>  <span class="va">bikers</span> <span class="op">~</span> <span class="va">day</span> <span class="op">+</span> <span class="va">hr</span> <span class="op">+</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">windspeed</span> <span class="op">+</span> <span class="va">workingday</span> <span class="op">+</span> <span class="va">hum</span> <span class="op">+</span> <span class="va">weathersit</span> <span class="op">+</span> <span class="va">season</span>,</span>
<span>  data <span class="op">=</span> <span class="va">bike</span>,</span>
<span>  max_interaction <span class="op">=</span> <span class="fl">3</span>, ntrees <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/purify.html">purify</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- Regression Random Planted Forest --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: bikers ~ day + hr + temp + windspeed + workingday + hum + weathersit +      season </span></span>
<span><span class="co">#&gt; Fit using 8 predictors and 3-degree interactions.</span></span>
<span><span class="co">#&gt; Forest is purified!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Called with parameters:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             loss: L2</span></span>
<span><span class="co">#&gt;           ntrees: 50</span></span>
<span><span class="co">#&gt;  max_interaction: 3</span></span>
<span><span class="co">#&gt;           splits: 30</span></span>
<span><span class="co">#&gt;        split_try: 10</span></span>
<span><span class="co">#&gt;            t_try: 0.4</span></span>
<span><span class="co">#&gt;            delta: 0</span></span>
<span><span class="co">#&gt;          epsilon: 0.1</span></span>
<span><span class="co">#&gt;    deterministic: FALSE</span></span>
<span><span class="co">#&gt;         parallel: FALSE</span></span>
<span><span class="co">#&gt;           purify: FALSE</span></span>
<span><span class="co">#&gt;               cv: FALSE</span></span></code></pre></div>
<p>We select the predictors of interest and use
<code><a href="../reference/predict_components.html">predict_components()</a></code> to retrieve all predictive components
that include them, from main effects to 3rd degree interactions. The
resulting object also contains the original data as <code>x</code>,
which we need for later visualization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span>, <span class="st">"workingday"</span>, <span class="st">"hum"</span>, <span class="st">"weathersit"</span>, <span class="st">"season"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">components</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_components.html">predict_components</a></span><span class="op">(</span><span class="va">rp</span>, <span class="va">bike</span>, predictors <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># There's a lot of components...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">components</span><span class="op">$</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'data.table' and 'data.frame':   8644 obs. of  41 variables:</span></span>
<span><span class="co">#&gt;  $ hr                          : num  -121 -121 -122 -123 -122 ...</span></span>
<span><span class="co">#&gt;  $ temp                        : num  -34.9 -34.9 -34.9 -34.9 -34.9 ...</span></span>
<span><span class="co">#&gt;  $ workingday                  : num  -1.06 -1.06 -1.06 -1.06 -1.06 ...</span></span>
<span><span class="co">#&gt;  $ hum                         : num  -9.97 -8.42 -8.42 -3.85 -3.85 ...</span></span>
<span><span class="co">#&gt;  $ weathersit                  : num  4.29 4.29 4.29 4.29 4.29 ...</span></span>
<span><span class="co">#&gt;  $ season                      : num  -22.1 -22.1 -22.1 -22.1 -22.1 ...</span></span>
<span><span class="co">#&gt;  $ hr:temp                     : num  29.1 29.1 29.4 29.3 29.3 ...</span></span>
<span><span class="co">#&gt;  $ hr:workingday               : num  9.82 9.82 9.82 9.82 9.11 ...</span></span>
<span><span class="co">#&gt;  $ hr:hum                      : num  6.33 5.23 5.23 2.02 2.02 ...</span></span>
<span><span class="co">#&gt;  $ hr:weathersit               : num  -2.99 -2.99 -2.99 -2.99 -2.99 ...</span></span>
<span><span class="co">#&gt;  $ hr:season                   : num  17.7 17.7 17.7 17.7 17.7 ...</span></span>
<span><span class="co">#&gt;  $ temp:workingday             : num  -8.92 -8.92 -8.92 -8.92 -8.92 ...</span></span>
<span><span class="co">#&gt;  $ hum:temp                    : num  3.7 3.56 3.56 2.39 2.39 ...</span></span>
<span><span class="co">#&gt;  $ temp:weathersit             : num  -0.18 -0.18 -0.18 -0.18 -0.18 ...</span></span>
<span><span class="co">#&gt;  $ season:temp                 : num  -1.39 -1.39 -1.39 -1.39 -1.39 ...</span></span>
<span><span class="co">#&gt;  $ hum:workingday              : num  -4.15 -3.95 -3.95 -3.4 -3.4 ...</span></span>
<span><span class="co">#&gt;  $ weathersit:workingday       : num  0.0136 0.0136 0.0136 0.0136 0.0136 ...</span></span>
<span><span class="co">#&gt;  $ season:workingday           : num  -0.668 -0.668 -0.668 -0.668 -0.668 ...</span></span>
<span><span class="co">#&gt;  $ hum:weathersit              : num  -0.0604 -0.1386 -0.1386 -0.3057 -0.3057 ...</span></span>
<span><span class="co">#&gt;  $ hum:season                  : num  1.497 0.795 0.795 0.322 0.322 ...</span></span>
<span><span class="co">#&gt;  $ season:weathersit           : num  -0.545 -0.545 -0.545 -0.545 -0.545 ...</span></span>
<span><span class="co">#&gt;  $ hr:temp:workingday          : num  3.84 3.84 3.84 3.84 3.84 ...</span></span>
<span><span class="co">#&gt;  $ hr:hum:temp                 : num  -1.39 -1.7 -1.7 -1.12 -1.12 ...</span></span>
<span><span class="co">#&gt;  $ hr:temp:weathersit          : num  0.0743 0.0743 0.0743 0.0743 0.0743 ...</span></span>
<span><span class="co">#&gt;  $ hr:season:temp              : num  0.697 0.697 0.697 0.697 0.697 ...</span></span>
<span><span class="co">#&gt;  $ hr:hum:workingday           : num  1.56 1.35 1.35 1.53 1.53 ...</span></span>
<span><span class="co">#&gt;  $ hr:weathersit:workingday    : num  0.0182 0.0182 0.0182 0.0182 0.0182 ...</span></span>
<span><span class="co">#&gt;  $ hr:season:workingday        : num  0.581 0.581 0.581 0.581 0.581 ...</span></span>
<span><span class="co">#&gt;  $ hr:hum:weathersit           : num  0.0631 0.1413 0.1413 0.3312 0.3312 ...</span></span>
<span><span class="co">#&gt;  $ hr:hum:season               : num  -1.0655 -0.3636 -0.3636 -0.0723 -0.0723 ...</span></span>
<span><span class="co">#&gt;  $ hr:season:weathersit        : num  0.455 0.455 0.455 0.455 0.455 ...</span></span>
<span><span class="co">#&gt;  $ hum:temp:workingday         : num  1.278 1.278 1.278 0.993 0.993 ...</span></span>
<span><span class="co">#&gt;  $ temp:weathersit:workingday  : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ season:temp:workingday      : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ hum:temp:weathersit         : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ hum:season:temp             : num  0.246 0.246 0.246 -0.126 -0.126 ...</span></span>
<span><span class="co">#&gt;  $ season:temp:weathersit      : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ hum:weathersit:workingday   : num  -0.00827 -0.00827 -0.00827 0.04039 0.04039 ...</span></span>
<span><span class="co">#&gt;  $ hum:season:workingday       : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ season:weathersit:workingday: num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ hum:season:weathersit       : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Please note that fitting the model, purification, and the extraction
of the components may take some time, depending on available resources
and the size of the data. For example, the above steps took around 50
seconds to complete on GitHub Actions.</p>
</div>
<div class="section level2">
<h2 id="main-effects">Main Effects<a class="anchor" aria-label="anchor" href="#main-effects"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"temp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"hr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"workingday"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_main</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/main-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="way-interactions">2-Way Interactions<a class="anchor" aria-label="anchor" href="#way-interactions"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_2way1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_2way2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_2way3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: scico</span></span>
<span></span>
<span><span class="va">p_2way</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p_2way1</span> <span class="op">/</span> <span class="va">p_2way2</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="va">p_2way3</span></span>
<span></span>
<span><span class="va">p_2way</span> <span class="op">&lt;-</span> <span class="va">p_2way</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1,2"</span>, <span class="st">"3,1"</span>, <span class="st">"3,3"</span><span class="op">)</span><span class="op">)</span>, tag_prefix <span class="op">=</span> <span class="st">"m("</span>, tag_suffix <span class="op">=</span> <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/twoway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="way-interaction">3-Way Interaction<a class="anchor" aria-label="anchor" href="#way-interaction"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_3way</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_threeway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_3way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/threeway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="everything-together">Everything Together<a class="anchor" aria-label="anchor" href="#everything-together"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">/</span> <span class="va">p_2way</span> <span class="op">/</span> <span class="va">p_3way</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/all-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="additional-effects">Additional effects<a class="anchor" aria-label="anchor" href="#additional-effects"></a>
</h2>
<p>All main effects:</p>
<p>Iterating over <code>vars</code> (hr, temp, workingday, hum,
weathersit, season), and passing each to <code>plot_main_effect</code>,
then collecting the plots with <code><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">patchwork::wrap_plots()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="va">plot_main_effect</span>, components <span class="op">=</span> <span class="va">components</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/all-main-effects-1.png" width="960" style="display: block; margin: auto;"></p>
<p>From here we use <code>autoplot</code> for convenience. Internally it
just passes its arguments on to the specialized <code>plot_*</code>
functions, depending on the number of predictors supplied.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-4-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"hr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-4-2.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-4-3.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weathersit"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-4-4.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hum"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-4-5.png" width="864" style="display: block; margin: auto;"></p>
<p>3rd degree interactions can be tricky, if they have any effect at
all.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"hr"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"hr"</span>, <span class="st">"season"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-5-2.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hard to interpret, likely spurious</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"hr"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-5-3.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># zero effect</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weathersit"</span>, <span class="st">"season"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/unnamed-chunk-5-4.png" width="864" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joseph Theo Meyer, Munir Hiabu, Maike Spankus, Marvin N. Wright, Lukas Burk.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
