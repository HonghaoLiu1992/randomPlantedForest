<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="randomPlantedForest">
<title>Bikesharing: Decomposition Example • randomPlantedForest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bikesharing: Decomposition Example">
<meta property="og:description" content="randomPlantedForest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">randomPlantedForest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Bikesharing-Decomposition-Example.html">Bikesharing: Decomposition Example</a>
    <a class="dropdown-item" href="../articles/test/Regression-Test-oldrpf.html">Regression Test: oldrpf</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PlantedML/randomPlantedForest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bikesharing: Decomposition Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PlantedML/randomPlantedForest/blob/HEAD/vignettes/articles/Bikesharing-Decomposition-Example.Rmd" class="external-link"><code>vignettes/articles/Bikesharing-Decomposition-Example.Rmd</code></a></small>
      <div class="d-none name"><code>Bikesharing-Decomposition-Example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PlantedML/randomPlantedForest" class="external-link">randomPlantedForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com" class="external-link">ISLR2</a></span><span class="op">)</span> <span class="co"># For Bikeshare dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># Some post-processing required!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># To arrange plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="preparing-the-data">Preparing the Data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h3>
<p>First we load the <code>Bikeshare</code> data from the
<code>ISLR2</code> package, which provides the dataset published at the
<a href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" class="external-link">UCI
Machine Learning Repository</a>.</p>
<blockquote>
<p>This data set contains the hourly and daily count of rental bikes
between years 2011 and 2012 in Capital bikeshare system, along with
weather and seasonal information.</p>
</blockquote>
<p>The outcome is going to be <code>bikers</code>, the total number of
bikers in the system.</p>
<p>The predictors of interest in our case are going to be the
following:</p>
<ul>
<li>
<code>hr</code>: Hour of day, 0 to 23 hours.</li>
<li>
<code>temp</code>: Normalized temperature in Celsius</li>
<li>
<code>workingday</code>: Binary value indicating whether it’s a work
day (1) or not (0)</li>
</ul>
<p>We recode the <code>hr</code> column from a 24-level
<code>factor</code> to a numeric column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">hr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bike</span><span class="op">)</span></span>
<span><span class="co">#&gt;    season mnth day hr holiday weekday workingday   weathersit temp  atemp  hum</span></span>
<span><span class="co">#&gt; 1:      1  Jan   1  0       0       6          0        clear 0.24 0.2879 0.81</span></span>
<span><span class="co">#&gt; 2:      1  Jan   1  1       0       6          0        clear 0.22 0.2727 0.80</span></span>
<span><span class="co">#&gt; 3:      1  Jan   1  2       0       6          0        clear 0.22 0.2727 0.80</span></span>
<span><span class="co">#&gt; 4:      1  Jan   1  3       0       6          0        clear 0.24 0.2879 0.75</span></span>
<span><span class="co">#&gt; 5:      1  Jan   1  4       0       6          0        clear 0.24 0.2879 0.75</span></span>
<span><span class="co">#&gt; 6:      1  Jan   1  5       0       6          0 cloudy/misty 0.24 0.2576 0.75</span></span>
<span><span class="co">#&gt;    windspeed casual registered bikers</span></span>
<span><span class="co">#&gt; 1:    0.0000      3         13     16</span></span>
<span><span class="co">#&gt; 2:    0.0000      8         32     40</span></span>
<span><span class="co">#&gt; 3:    0.0000      5         27     32</span></span>
<span><span class="co">#&gt; 4:    0.0000      3         10     13</span></span>
<span><span class="co">#&gt; 5:    0.0000      0          1      1</span></span>
<span><span class="co">#&gt; 6:    0.0896      0          1      1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-purification-component-extraction">Fitting, Purification, Component Extraction<a class="anchor" aria-label="anchor" href="#fitting-purification-component-extraction"></a>
</h3>
<p>Next we can fit a Random Planted Forest on the <code>bikers</code>
variable, using a subset of the available predictors. We limit the
model’s complexity by setting <code>max_interaction = 3</code>, as we
are only going to visualize interactions up to the third degree, and
using a higher value here might only marginally improve predictive
performance at the cost of a longer runtime. For our example here, a
smaller model with merely 20 trees suffices. We also <code>purify</code>
the forest to enable the desired decomposition. This step is not
required for global predictions and may take some time, which is why it
is implemented as a separate step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpf.html">rpf</a></span><span class="op">(</span></span>
<span>  <span class="va">bikers</span> <span class="op">~</span> <span class="va">day</span> <span class="op">+</span> <span class="va">hr</span> <span class="op">+</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">windspeed</span> <span class="op">+</span> <span class="va">workingday</span> <span class="op">+</span> <span class="va">hum</span>,</span>
<span>  data <span class="op">=</span> <span class="va">bike</span>,</span>
<span>  max_interaction <span class="op">=</span> <span class="fl">3</span>, ntrees <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/purify.html">purify</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- Regression Random Planted Forest --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: bikers ~ day + hr + temp + windspeed + workingday + hum </span></span>
<span><span class="co">#&gt; Fit using 6 predictors and 3-degree interactions.</span></span>
<span><span class="co">#&gt; Forest is purified!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Called with parameters:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             loss: L2</span></span>
<span><span class="co">#&gt;           ntrees: 20</span></span>
<span><span class="co">#&gt;  max_interaction: 3</span></span>
<span><span class="co">#&gt;           splits: 30</span></span>
<span><span class="co">#&gt;        split_try: 10</span></span>
<span><span class="co">#&gt;            t_try: 0.4</span></span>
<span><span class="co">#&gt;            delta: 0</span></span>
<span><span class="co">#&gt;          epsilon: 0.1</span></span>
<span><span class="co">#&gt;    deterministic: FALSE</span></span>
<span><span class="co">#&gt;         parallel: FALSE</span></span>
<span><span class="co">#&gt;           purify: FALSE</span></span>
<span><span class="co">#&gt;               cv: FALSE</span></span></code></pre></div>
<p>We select the predictors of interest and use
<code><a href="../reference/extract_components.html">extract_components()</a></code> to retrieve all predictive components
that include them, from main effects to 3rd degree interactions. We also
create an auxiliary table in long format which includes the observed
predictor values, which we use for the plot of the main effects.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span>, <span class="st">"workingday"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_components.html">extract_components</a></span><span class="op">(</span><span class="va">rp</span>, <span class="va">bike</span>, predictors <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span>
<span><span class="va">ms</span></span>
<span><span class="co">#&gt;       intercept         hr      temp workingday      hr:temp hr:workingday</span></span>
<span><span class="co">#&gt;    1:  143.2853 -120.03035 -41.37863   1.230205  36.72889259    10.4351399</span></span>
<span><span class="co">#&gt;    2:  143.2853 -120.03035 -41.37863   1.230205  36.72889259    10.4351399</span></span>
<span><span class="co">#&gt;    3:  143.2853 -121.93906 -41.37863   1.230205  36.72889259     8.7556011</span></span>
<span><span class="co">#&gt;    4:  143.2853 -121.93906 -41.37863   1.230205  36.72889259     8.7556011</span></span>
<span><span class="co">#&gt;    5:  143.2853 -121.93906 -41.37863   1.230205  36.72889259     8.7556011</span></span>
<span><span class="co">#&gt;   ---                                                                     </span></span>
<span><span class="co">#&gt; 8641:  143.2853   85.18923 -15.58770   1.230205 -22.67729239   -37.2148270</span></span>
<span><span class="co">#&gt; 8642:  143.2853   30.43344 -15.58770   1.230205 -10.32501271   -18.6352794</span></span>
<span><span class="co">#&gt; 8643:  143.2853  -17.49218 -20.20000   1.230205  -1.36339065    -4.8843326</span></span>
<span><span class="co">#&gt; 8644:  143.2853  -45.84159 -25.18386   1.230205   2.36921704     0.7853175</span></span>
<span><span class="co">#&gt; 8645:  143.2853  -48.94899 -30.94988   1.230205  -0.04613987     0.7853175</span></span>
<span><span class="co">#&gt;       temp:workingday hr:temp:workingday</span></span>
<span><span class="co">#&gt;    1:      -10.066455           2.339399</span></span>
<span><span class="co">#&gt;    2:      -10.066455           2.339399</span></span>
<span><span class="co">#&gt;    3:      -10.066455           2.339399</span></span>
<span><span class="co">#&gt;    4:      -10.066455           2.339399</span></span>
<span><span class="co">#&gt;    5:      -10.066455           2.339399</span></span>
<span><span class="co">#&gt;   ---                                   </span></span>
<span><span class="co">#&gt; 8641:       -3.357617           9.564732</span></span>
<span><span class="co">#&gt; 8642:       -3.357617           4.203181</span></span>
<span><span class="co">#&gt; 8643:       -3.902431           3.454540</span></span>
<span><span class="co">#&gt; 8644:       -7.819389           7.371499</span></span>
<span><span class="co">#&gt; 8645:       -7.819389           7.371499</span></span>
<span></span>
<span><span class="va">ms_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">colname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">colname</span>, value <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="va">colname</span><span class="op">]</span><span class="op">]</span>, m <span class="op">=</span> <span class="va">ms</span><span class="op">[[</span><span class="va">colname</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ms_long</span></span>
<span><span class="co">#&gt;          variable value           m</span></span>
<span><span class="co">#&gt;     1:         hr     0 -120.030353</span></span>
<span><span class="co">#&gt;     2:         hr     1 -120.030353</span></span>
<span><span class="co">#&gt;     3:         hr     2 -121.939063</span></span>
<span><span class="co">#&gt;     4:         hr     3 -121.939063</span></span>
<span><span class="co">#&gt;     5:         hr     4 -121.939063</span></span>
<span><span class="co">#&gt;    ---                             </span></span>
<span><span class="co">#&gt; 25931: workingday     0    1.230205</span></span>
<span><span class="co">#&gt; 25932: workingday     0    1.230205</span></span>
<span><span class="co">#&gt; 25933: workingday     0    1.230205</span></span>
<span><span class="co">#&gt; 25934: workingday     0    1.230205</span></span>
<span><span class="co">#&gt; 25935: workingday     0    1.230205</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="main-effects">Main Effects<a class="anchor" aria-label="anchor" href="#main-effects"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ms_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Feature Value"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">Main</span> <span class="op">~</span> <span class="va">effects</span> <span class="op">~</span> <span class="fu">italic</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_main</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/main-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="way-interactions">2-Way Interactions<a class="anchor" aria-label="anchor" href="#way-interactions"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int2way_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="st">"hr"</span>,</span>
<span>    value <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"hr"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    workingday <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"workingday"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    m <span class="op">=</span> <span class="va">ms</span><span class="op">[[</span><span class="st">"hr:workingday"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="st">"temp"</span>, value <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"temp"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    workingday <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"workingday"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    m <span class="op">=</span> <span class="va">ms</span><span class="op">[[</span><span class="st">"temp:workingday"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">int2way_long</span><span class="op">[</span>, <span class="va">workingday</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">workingday</span>,</span>
<span>  levels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No working day"</span>, <span class="st">"Working day"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">int2way_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>hr <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"hr"</span><span class="op">]</span><span class="op">]</span>, temp <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"temp"</span><span class="op">]</span><span class="op">]</span>, m <span class="op">=</span> <span class="va">ms</span><span class="op">[[</span><span class="st">"hr:temp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">int2way_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">m</span>, col <span class="op">=</span> <span class="va">workingday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Feature Value"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">way</span> <span class="op">~</span> <span class="va">interactions</span> <span class="op">~</span> <span class="fu">italic</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">jk</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">int2way_wide</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hr</span>, y <span class="op">=</span> <span class="va">temp</span>, color <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">jk</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way</span> <span class="op">&lt;-</span> <span class="va">p_2way_1</span> <span class="op">+</span> <span class="va">p_2way_2</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.55</span>, <span class="fl">.45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_2way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/twoway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="way-interaction">3-Way Interaction<a class="anchor" aria-label="anchor" href="#way-interaction"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int3way</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  hr <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"hr"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  temp <span class="op">=</span> <span class="va">bike</span><span class="op">[[</span><span class="st">"temp"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  workingday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">bike</span><span class="op">[[</span><span class="st">"workingday"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span>,</span>
<span>                 labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No working day"</span>, <span class="st">"Working day"</span><span class="op">)</span></span>
<span>               <span class="op">)</span>,</span>
<span>  m <span class="op">=</span> <span class="va">ms</span><span class="op">[[</span><span class="st">"hr:temp:workingday"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_3way</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">int3way</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hr</span>, y <span class="op">=</span> <span class="va">temp</span>, color <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">workingday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">atop</span><span class="op">(</span><span class="fl">3</span> <span class="op">-</span> <span class="va">way</span> <span class="op">~</span> <span class="va">interactions</span> <span class="op">~</span> <span class="fu">italic</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">jkl</span><span class="op">]</span><span class="op">)</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">jkl</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_3way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/threeway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="everything-together">Everything Together<a class="anchor" aria-label="anchor" href="#everything-together"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">+</span> <span class="va">p_2way</span> <span class="op">+</span> <span class="va">p_3way</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-Example_files/figure-html/all-effects-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joseph Theo Meyer, Munir Hiabu, Maike Spankus, Marvin N. Wright, Lukas Burk.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
